<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø­ØµØ§Ø¡ Ø§Ù„Ø²ÙˆØ§Ø± - Ø¬Ù…ÙŠÙ„ Ø§Ù„Ø­Ø·Ø§Ù…ÙŠ | ØªØ³ÙˆÙŠÙ‚ ÙˆÙ…Ø¨ÙŠØ¹Ø§Øª</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-color: #27ae60;
            --warning-color: #f39c12;
        }
        
        body {
            background: var(--gradient);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-attachment: fixed;
            padding: 20px 0;
        }
        
        .visitor-card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: transform 0.3s ease;
            overflow: hidden;
        }
        
        .visitor-card:hover {
            transform: translateY(-5px);
        }
        
        .counter-number {
            font-size: 3.5rem;
            font-weight: bold;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            font-family: 'Arial', sans-serif;
            line-height: 1.2;
        }
        
        .visitor-label {
            color: #5a6c7d;
            font-size: 1.1rem;
            margin-top: 8px;
            font-weight: 500;
        }
        
        .stats-badge {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border-radius: 50px;
            padding: 8px 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .company-logo {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .firebase-status {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1000;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .firebase-status:hover {
            transform: scale(1.05);
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .time-display {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 10px 20px;
            font-weight: 500;
            color: var(--primary-color);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn-custom {
            border-radius: 50px;
            padding: 10px 25px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
        }
        
        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .alert-custom {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border: none;
            min-width: 300px;
        }
        
        .config-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 2px dashed #dee2e6;
        }
        
        .config-field {
            margin-bottom: 15px;
        }
        
        .config-field label {
            font-weight: 500;
            margin-bottom: 5px;
            color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .counter-number {
                font-size: 2.5rem;
            }
            
            .company-logo {
                font-size: 1.4rem;
            }
            
            .visitor-card {
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Ø´Ø±ÙŠØ· Ø­Ø§Ù„Ø© Firebase -->
    <div class="firebase-status">
        <span class="badge bg-secondary" id="firebaseStatus">
            <i class="bi bi-database"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...
        </span>
    </div>

    <div class="container py-4">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
                <div class="visitor-card p-4 p-md-5 mb-4">
                    <!-- Ø±Ø£Ø³ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
                        <div class="company-logo mb-3 mb-md-0">
                            <i class="bi bi-shop-window text-primary"></i>
                            <span>Ø¬Ù…ÙŠÙ„ Ø§Ù„Ø­Ø·Ø§Ù…ÙŠ | ØªØ³ÙˆÙŠÙ‚ ÙˆÙ…Ø¨ÙŠØ¹Ø§Øª</span>
                        </div>
                        <div class="stats-badge">
                            <i class="bi bi-graph-up-arrow"></i>
                            Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¡ Ø§Ù„Ø­ÙŠ
                        </div>
                    </div>
                    
                    <p class="text-center text-muted mb-4">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø²ÙˆØ§Ø± ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù…ØªØ¬Ø± Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</p>
                    
                    <!-- Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
                    <div class="row text-center mb-5">
                        <div class="col-md-6 mb-4">
                            <div class="counter-number pulse" id="totalVisitors">0</div>
                            <div class="visitor-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø²ÙˆØ§Ø±</div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="counter-number" id="todayVisitors">0</div>
                            <div class="visitor-label">Ø²ÙˆØ§Ø± Ø§Ù„ÙŠÙˆÙ…</div>
                        </div>
                    </div>

                    <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© -->
                    <div class="row text-center mb-4">
                        <div class="col-6 col-md-3 mb-3">
                            <div class="stat-card">
                                <div class="stat-value text-success" id="uniqueVisitors">0</div>
                                <div class="stat-label">Ø²ÙˆØ§Ø± ÙØ±ÙŠØ¯ÙˆÙ†</div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="stat-card">
                                <div class="stat-value text-info" id="returningVisitors">0</div>
                                <div class="stat-label">Ø²ÙˆØ§Ø± Ø¹Ø§Ø¦Ø¯ÙˆÙ†</div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="stat-card">
                                <div class="stat-value text-warning" id="onlineNow">0</div>
                                <div class="stat-label">Ù…ØªØµÙØ­ÙˆÙ† Ø§Ù„Ø¢Ù†</div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3 mb-3">
                            <div class="stat-card">
                                <div class="stat-value text-primary" id="pageViews">0</div>
                                <div class="stat-label">Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø©</div>
                            </div>
                        </div>
                    </div>

                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆÙ‚Øª -->
                    <div class="text-center mb-4">
                        <div class="time-display d-inline-block" id="currentTime">
                            Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª...
                        </div>
                    </div>

                    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
                    <div class="d-flex justify-content-center flex-wrap gap-3 mt-4">
                        <button class="btn btn-primary btn-custom" onclick="refreshData()" id="refreshBtn">
                            <i class="bi bi-arrow-repeat"></i>
                            ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                        <button class="btn btn-outline-secondary btn-custom" onclick="showStats()">
                            <i class="bi bi-graph-up"></i>
                            Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                        </button>
                        <button class="btn btn-success btn-custom" onclick="simulateVisitor()">
                            <i class="bi bi-person-plus"></i>
                            Ù…Ø­Ø§ÙƒØ§Ø© Ø²Ø§Ø¦Ø±
                        </button>
                    </div>
                </div>
                
                <!-- Ù‚Ø³Ù… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase -->
                <div class="config-box">
                    <h5 class="text-center mb-4">
                        <i class="bi bi-database-gear"></i>
                        Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Firebase)
                    </h5>
                    
                    <div class="row">
                        <div class="col-md-6 config-field">
                            <label for="apiKey">Ù…ÙØªØ§Ø­ API (apiKey)</label>
                            <input type="text" class="form-control" id="apiKey" placeholder="AIzaSyBcDeFgHiJkLmNoPqRsTuVwXyZ...">
                        </div>
                        <div class="col-md-6 config-field">
                            <label for="authDomain">Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (authDomain)</label>
                            <input type="text" class="form-control" id="authDomain" placeholder="Ù…Ø´Ø±ÙˆØ¹Ùƒ.firebaseapp.com">
                        </div>
                        <div class="col-md-6 config-field">
                            <label for="databaseURL">Ø±Ø§Ø¨Ø· Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (databaseURL)</label>
                            <input type="text" class="form-control" id="databaseURL" placeholder="https://Ù…Ø´Ø±ÙˆØ¹Ùƒ-default-rtdb.firebaseio.com">
                        </div>
                        <div class="col-md-6 config-field">
                            <label for="projectId">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (projectId)</label>
                            <input type="text" class="form-control" id="projectId" placeholder="Ù…Ø´Ø±ÙˆØ¹Ùƒ-12345">
                        </div>
                        <div class="col-md-6 config-field">
                            <label for="storageBucket">Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† (storageBucket)</label>
                            <input type="text" class="form-control" id="storageBucket" placeholder="Ù…Ø´Ø±ÙˆØ¹Ùƒ.appspot.com">
                        </div>
                        <div class="col-md-6 config-field">
                            <label for="messagingSenderId">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø±Ø³Ù„ (messagingSenderId)</label>
                            <input type="text" class="form-control" id="messagingSenderId" placeholder="123456789">
                        </div>
                        <div class="col-12 config-field">
                            <label for="appId">Ù…Ø¹Ø±Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (appId)</label>
                            <input type="text" class="form-control" id="appId" placeholder="1:123456789:web:abc123def456">
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <button class="btn btn-success btn-custom px-5" onclick="saveFirebaseConfig()">
                            <i class="bi bi-check-circle"></i>
                            Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…
                        </button>
                        <button class="btn btn-outline-info btn-custom ms-2" onclick="loadSampleConfig()">
                            <i class="bi bi-info-circle"></i>
                            Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ù„Ù„ØªÙƒÙˆÙŠÙ†
                        </button>
                    </div>
                    
                    <div class="alert alert-info mt-4" role="alert">
                        <h6><i class="bi bi-lightbulb"></i> ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø©:</h6>
                        <ol class="mb-0 ps-3">
                            <li>Ø£Ù†Ø´Ø¦ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ ÙÙŠ <a href="https://console.firebase.google.com" target="_blank">Firebase Console</a></li>
                            <li>Ø£Ø¶Ù ØªØ·Ø¨ÙŠÙ‚ ÙˆÙŠØ¨ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙƒÙˆÙŠÙ†</li>
                            <li>Ø§Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø£Ø¹Ù„Ø§Ù‡</li>
                            <li>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"</li>
                            <li>ÙÙŠ ØµÙØ­Ø© Firebase ConsoleØŒ Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Realtime Database ÙˆØ£Ù†Ø´Ø¦ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© -->
    <div class="modal fade" id="statsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-bar-chart-line"></i>
                        ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="statsContent">
                        Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…ÙƒØªØ¨Ø§Øª JavaScript -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // =============================================
        // Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Firebase ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯
        // =============================================
        
        class RealTimeVisitorCounter {
            constructor() {
                this.db = null;
                this.visitorId = this.generateVisitorId();
                this.isNewVisitor = false;
                this.isInitialized = false;
                this.init();
            }

            init() {
                this.setupTimeUpdater();
                this.loadFirebaseConfig();
            }

            // ØªØ­Ù…ÙŠÙ„ ØªÙƒÙˆÙŠÙ† Firebase Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
            loadFirebaseConfig() {
                const savedConfig = localStorage.getItem('firebaseConfig');
                if (savedConfig) {
                    try {
                        const config = JSON.parse(savedConfig);
                        this.initializeFirebase(config);
                        this.populateConfigForm(config);
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙƒÙˆÙŠÙ† Firebase:', error);
                        this.updateFirebaseStatus('error', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙƒÙˆÙŠÙ†');
                    }
                } else {
                    this.updateFirebaseStatus('disconnected', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¨Ø¹Ø¯');
                }
            }

            // ØªØ¹Ø¨Ø¦Ø© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            populateConfigForm(config) {
                document.getElementById('apiKey').value = config.apiKey || '';
                document.getElementById('authDomain').value = config.authDomain || '';
                document.getElementById('databaseURL').value = config.databaseURL || '';
                document.getElementById('projectId').value = config.projectId || '';
                document.getElementById('storageBucket').value = config.storageBucket || '';
                document.getElementById('messagingSenderId').value = config.messagingSenderId || '';
                document.getElementById('appId').value = config.appId || '';
            }

            // ØªÙ‡ÙŠØ¦Ø© Firebase
            initializeFirebase(config) {
                try {
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ØªÙƒÙˆÙŠÙ†
                    if (!config.apiKey || config.apiKey.includes('Ø¶Ø¹')) {
                        throw new Error('ØªÙƒÙˆÙŠÙ† Firebase ØºÙŠØ± ØµØ§Ù„Ø­');
                    }

                    firebase.initializeApp(config);
                    this.db = firebase.database();
                    this.isInitialized = true;
                    
                    this.updateFirebaseStatus('connected', 'Firebase Ù…ØªØµÙ„');
                    this.initializeVisitor();
                    this.setupRealTimeListeners();
                    
                    console.log('âœ… Firebase initialized successfully');
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase:', error);
                    this.updateFirebaseStatus('error', 'Firebase ØºÙŠØ± Ù…ØªØµÙ„');
                    this.setupLocalData();
                }
            }

            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Firebase ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            updateFirebaseStatus(status, message) {
                const statusElement = document.getElementById('firebaseStatus');
                let badgeClass = 'bg-secondary';
                let icon = 'bi-database';
                
                switch(status) {
                    case 'connected':
                        badgeClass = 'bg-success';
                        icon = 'bi-database-check';
                        break;
                    case 'disconnected':
                        badgeClass = 'bg-warning';
                        icon = 'bi-database-exclamation';
                        break;
                    case 'error':
                        badgeClass = 'bg-danger';
                        icon = 'bi-database-x';
                        break;
                }
                
                statusElement.className = `badge ${badgeClass}`;
                statusElement.innerHTML = `<i class="bi ${icon}"></i> ${message}`;
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ù„Ø²Ø§Ø¦Ø±
            generateVisitorId() {
                let visitorId = localStorage.getItem('visitorId');
                if (!visitorId) {
                    visitorId = 'visitor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('visitorId', visitorId);
                    this.isNewVisitor = true;
                }
                return visitorId;
            }

            // ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø±
            async initializeVisitor() {
                if (!this.isInitialized) return;

                const today = this.getTodayDate();
                const visitorRef = this.db.ref('visitors/' + this.visitorId);
                
                try {
                    // ØªØ³Ø¬ÙŠÙ„ Ø²ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    await visitorRef.update({
                        lastVisit: new Date().toISOString(),
                        visitCount: firebase.database.ServerValue.increment(1),
                        firstVisit: this.isNewVisitor ? new Date().toISOString() : null
                    });

                    // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…
                    const todayRef = this.db.ref('dailyStats/' + today);
                    await todayRef.transaction((current) => {
                        if (current === null) {
                            return {
                                totalVisits: 1,
                                uniqueVisitors: this.isNewVisitor ? 1 : 0,
                                pageViews: 1,
                                lastUpdated: new Date().toISOString()
                            };
                        } else {
                            current.totalVisits = (current.totalVisits || 0) + 1;
                            current.pageViews = (current.pageViews || 0) + 1;
                            
                            if (this.isNewVisitor) {
                                current.uniqueVisitors = (current.uniqueVisitors || 0) + 1;
                            }
                            
                            current.lastUpdated = new Date().toISOString();
                            return current;
                        }
                    });

                    // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹Ø§Ù…
                    const totalRef = this.db.ref('totalStats');
                    await totalRef.transaction((current) => {
                        if (current === null) {
                            return {
                                totalVisitors: this.isNewVisitor ? 1 : 0,
                                totalPageViews: 1,
                                lastUpdated: new Date().toISOString()
                            };
                        } else {
                            if (this.isNewVisitor) {
                                current.totalVisitors = (current.totalVisitors || 0) + 1;
                            }
                            current.totalPageViews = (current.totalPageViews || 0) + 1;
                            current.lastUpdated = new Date().toISOString();
                            return current;
                        }
                    });

                    console.log('âœ… Visitor data initialized in Firebase');
                } catch (error) {
                    console.error('âŒ Error initializing visitor data:', error);
                    this.setupLocalData();
                }
            }

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
            setupRealTimeListeners() {
                if (!this.isInitialized) return;

                const today = this.getTodayDate();
                
                // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…
                this.db.ref('dailyStats/' + today).on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        document.getElementById('todayVisitors').textContent = this.formatNumber(data.uniqueVisitors || 0);
                        document.getElementById('pageViews').textContent = this.formatNumber(data.pageViews || 0);
                    }
                });

                // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                this.db.ref('totalStats').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        document.getElementById('totalVisitors').textContent = this.formatNumber(data.totalVisitors || 0);
                        document.getElementById('uniqueVisitors').textContent = this.formatNumber(data.totalVisitors || 0);
                        
                        // Ù…Ø­Ø§ÙƒØ§Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²ÙˆØ§Ø± Ø§Ù„Ø¹Ø§Ø¦Ø¯ÙŠÙ†
                        const returningVisitors = Math.floor((data.totalVisitors || 0) * 0.3);
                        document.getElementById('returningVisitors').textContent = this.formatNumber(returningVisitors);
                    }
                });

                // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹
                this.setupOnlineUsersSimulation();
            }

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© (Ø¨Ø¯ÙŠÙ„ Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§ØªØµØ§Ù„ Firebase)
            setupLocalData() {
                console.log('ğŸ”„ Using local data as fallback');
                
                const localData = JSON.parse(localStorage.getItem('visitorLocalData') || '{}');
                const today = this.getTodayDate();
                
                if (!localData[today]) {
                    localData[today] = {
                        uniqueVisitors: 0,
                        pageViews: 0
                    };
                }
                
                if (this.isNewVisitor) {
                    localData[today].uniqueVisitors++;
                }
                localData[today].pageViews++;
                
                localStorage.setItem('visitorLocalData', JSON.stringify(localData));
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                document.getElementById('todayVisitors').textContent = this.formatNumber(localData[today].uniqueVisitors);
                document.getElementById('pageViews').textContent = this.formatNumber(localData[today].pageViews);
                document.getElementById('totalVisitors').textContent = this.formatNumber(Object.values(localData).reduce((sum, day) => sum + day.uniqueVisitors, 0));
                document.getElementById('uniqueVisitors').textContent = this.formatNumber(Object.values(localData).reduce((sum, day) => sum + day.uniqueVisitors, 0));
                
                this.setupOnlineUsersSimulation();
            }

            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹
            setupOnlineUsersSimulation() {
                setInterval(() => {
                    const onlineUsers = Math.floor(Math.random() * 15) + 5;
                    document.getElementById('onlineNow').textContent = this.formatNumber(onlineUsers);
                }, 30000);
                
                // Ù‚ÙŠÙ…Ø© Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©
                document.getElementById('onlineNow').textContent = this.formatNumber(Math.floor(Math.random() * 10) + 3);
            }

            // Ù…Ø­Ø§ÙƒØ§Ø© Ø²Ø§Ø¦Ø± Ø¬Ø¯ÙŠØ¯ (Ù„Ù„ØªØ¬Ø±Ø¨Ø©)
            simulateNewVisitor() {
                if (!this.isInitialized) {
                    // Ù…Ø­Ø§ÙƒØ§Ø© Ù…Ø­Ù„ÙŠØ©
                    this.setupLocalData();
                    return;
                }

                const today = this.getTodayDate();
                const todayRef = this.db.ref('dailyStats/' + today);
                const totalRef = this.db.ref('totalStats');
                
                todayRef.transaction((current) => {
                    if (current === null) {
                        return {
                            totalVisits: 1,
                            uniqueVisitors: 1,
                            pageViews: 1,
                            lastUpdated: new Date().toISOString()
                        };
                    } else {
                        current.totalVisits = (current.totalVisits || 0) + 1;
                        current.uniqueVisitors = (current.uniqueVisitors || 0) + 1;
                        current.pageViews = (current.pageViews || 0) + 1;
                        current.lastUpdated = new Date().toISOString();
                        return current;
                    }
                });

                totalRef.transaction((current) => {
                    if (current === null) {
                        return {
                            totalVisitors: 1,
                            totalPageViews: 1,
                            lastUpdated: new Date().toISOString()
                        };
                    } else {
                        current.totalVisitors = (current.totalVisitors || 0) + 1;
                        current.totalPageViews = (current.totalPageViews || 0) + 1;
                        current.lastUpdated = new Date().toISOString();
                        return current;
                    }
                });
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
            setupTimeUpdater() {
                const updateTime = () => {
                    const now = new Date();
                    const options = { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    };
                    
                    const timeString = now.toLocaleDateString('ar-YE', options) + ' ğŸ•’';
                    document.getElementById('currentTime').textContent = timeString;
                };

                updateTime();
                setInterval(updateTime, 1000);
            }

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… Ø¨ØµÙŠØºØ© YYYY-MM-DD
            getTodayDate() {
                const now = new Date();
                return now.toISOString().split('T')[0];
            }

            // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
            formatNumber(num) {
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
        }

        // =============================================
        // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        // =============================================

        let visitorCounter;

        function refreshData() {
            const btn = document.getElementById('refreshBtn');
            btn.classList.add('loading');
            btn.innerHTML = '<i class="bi bi-arrow-repeat spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...';
            
            setTimeout(() => {
                btn.classList.remove('loading');
                btn.innerHTML = '<i class="bi bi-arrow-repeat"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                
                // Ø¥Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ Ø§Ù„ØªØ­Ø¯ÙŠØ«
                showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²ÙˆØ§Ø± Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            }, 1000);
        }

        function showStats() {
            const statsModal = new bootstrap.Modal(document.getElementById('statsModal'));
            const statsContent = document.getElementById('statsContent');
            
            if (!visitorCounter || !visitorCounter.isInitialized) {
                // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                const localData = JSON.parse(localStorage.getItem('visitorLocalData') || '{}');
                const today = visitorCounter ? visitorCounter.getTodayDate() : new Date().toISOString().split('T')[0];
                const todayData = localData[today] || { uniqueVisitors: 0, pageViews: 0 };
                const totalVisitors = Object.values(localData).reduce((sum, day) => sum + day.uniqueVisitors, 0);
                const totalPageViews = Object.values(localData).reduce((sum, day) => sum + day.pageViews, 0);
                
                statsContent.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© (Firebase ØºÙŠØ± Ù…ØªØµÙ„)
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø²ÙˆØ§Ø±:</strong>
                        </div>
                        <div class="col-6">
                            ${totalVisitors}
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-6">
                            <strong>Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø©:</strong>
                        </div>
                        <div class="col-6">
                            ${totalPageViews}
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-6">
                            <strong>Ø²ÙˆØ§Ø± Ø§Ù„ÙŠÙˆÙ…:</strong>
                        </div>
                        <div class="col-6">
                            ${todayData.uniqueVisitors}
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-6">
                            <strong>Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…:</strong>
                        </div>
                        <div class="col-6">
                            ${todayData.pageViews}
                        </div>
                    </div>
                    <hr>
                    <div class="text-center text-muted small">
                        Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${new Date().toLocaleString('ar-YE')}
                    </div>
                `;
            } else {
                // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
                const today = visitorCounter.getTodayDate();
                const db = visitorCounter.db;
                
                Promise.all([
                    db.ref('totalStats').once('value'),
                    db.ref('dailyStats/' + today).once('value'),
                    db.ref('visitors').once('value')
                ]).then(([totalSnapshot, dailySnapshot, visitorsSnapshot]) => {
                    const totalStats = totalSnapshot.val() || {};
                    const dailyStats = dailySnapshot.val() || {};
                    const visitorsCount = visitorsSnapshot.numChildren();
                    
                    statsContent.innerHTML = `
                        <div class="alert alert-success">
                            <i class="bi bi-database-check"></i>
                            <strong>Ø¨ÙŠØ§Ù†Ø§Øª Ø­ÙŠØ© Ù…Ù† Firebase</strong>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø²ÙˆØ§Ø±:</strong>
                            </div>
                            <div class="col-6">
                                ${totalStats.totalVisitors || 0}
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-6">
                                <strong>Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø©:</strong>
                            </div>
                            <div class="col-6">
                                ${totalStats.totalPageViews || 0}
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-6">
                                <strong>Ø²ÙˆØ§Ø± Ø§Ù„ÙŠÙˆÙ…:</strong>
                            </div>
                            <div class="col-6">
                                ${dailyStats.uniqueVisitors || 0}
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-6">
                                <strong>Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…:</strong>
                            </div>
                            <div class="col-6">
                                ${dailyStats.pageViews || 0}
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-6">
                                <strong>Ø§Ù„Ø²ÙˆØ§Ø± Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†:</strong>
                            </div>
                            <div class="col-6">
                                ${visitorsCount}
                            </div>
                        </div>
                        <hr>
                        <div class="text-center text-muted small">
                            Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${new Date().toLocaleString('ar-YE')}
                        </div>
                    `;
                }).catch(error => {
                    statsContent.innerHTML = `<div class="alert alert-danger">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}</div>`;
                });
            }
            
            statsModal.show();
        }

        function simulateVisitor() {
            if (visitorCounter) {
                visitorCounter.simulateNewVisitor();
                showAlert('ØªÙ…Øª Ù…Ø­Ø§ÙƒØ§Ø© Ø²Ø§Ø¦Ø± Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!', 'info');
            } else {
                showAlert('Ø§Ù„Ù†Ø¸Ø§Ù… ØºÙŠØ± Ù…Ù‡ÙŠØ¦ Ø¨Ø¹Ø¯. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Ø£ÙˆÙ„Ø§Ù‹.', 'warning');
            }
        }

        function saveFirebaseConfig() {
            try {
                const config = {
                    apiKey: document.getElementById('apiKey').value,
                    authDomain: document.getElementById('authDomain').value,
                    databaseURL: document.getElementById('databaseURL').value,
                    projectId: document.getElementById('projectId').value,
                    storageBucket: document.getElementById('storageBucket').value,
                    messagingSenderId: document.getElementById('messagingSenderId').value,
                    appId: document.getElementById('appId').value
                };
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                if (!config.apiKey || !config.databaseURL || !config.projectId) {
                    throw new Error('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: apiKey Ùˆ databaseURL Ùˆ projectId');
                }
                
                localStorage.setItem('firebaseConfig', JSON.stringify(config));
                
                showAlert('ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...', 'success');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…
                setTimeout(() => {
                    location.reload();
                }, 2000);
                
            } catch (error) {
                showAlert('Ø®Ø·Ø£: ' + error.message, 'danger');
            }
        }

        function loadSampleConfig() {
            const sampleConfig = {
                apiKey: "AIzaSyBcDeFgHiJkLmNoPqRsTuVwXyZ...",
                authDomain: "Ù…Ø´Ø±ÙˆØ¹Ùƒ.firebaseapp.com",
                databaseURL: "https://Ù…Ø´Ø±ÙˆØ¹Ùƒ-default-rtdb.firebaseio.com",
                projectId: "Ù…Ø´Ø±ÙˆØ¹Ùƒ-12345",
                storageBucket: "Ù…Ø´Ø±ÙˆØ¹Ùƒ.appspot.com",
                messagingSenderId: "123456789",
                appId: "1:123456789:web:abc123def456"
            };
            
            visitorCounter.populateConfigForm(sampleConfig);
            showAlert('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Ù„Ù„ØªÙƒÙˆÙŠÙ†. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©.', 'info');
        }

        function showAlert(message, type) {
            // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø³Ø§Ø¨Ù‚Ø©
            const existingAlerts = document.querySelectorAll('.alert-custom');
            existingAlerts.forEach(alert => alert.remove());
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-custom alert-dismissible fade show`;
            alertDiv.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="bi ${type === 'success' ? 'bi-check-circle' : type === 'danger' ? 'bi-exclamation-triangle' : type === 'warning' ? 'bi-exclamation-circle' : 'bi-info-circle'} me-2"></i>
                    <div>${message}</div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // =============================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        // =============================================

        document.addEventListener('DOMContentLoaded', function() {
            visitorCounter = new RealTimeVisitorCounter();
            console.log('ğŸš€ Real-time visitor counter initialized');
            
            // Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø´Ø±ÙŠØ· Ø­Ø§Ù„Ø© Firebase
            const firebaseStatus = document.getElementById('firebaseStatus');
            firebaseStatus.style.cursor = 'pointer';
            firebaseStatus.title = 'Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase';
            firebaseStatus.onclick = () => {
                document.querySelector('.config-box').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            };
        });
    </script>
</body>
</html>
